
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>A tour of navground &#8212; navground 0.0.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script src="../_static/documentation_options.js?v=f52f92e8"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/tour';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Packages" href="../packages/index.html" />
    <link rel="prev" title="Installation" href="../installation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">navground 0.0.2 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">A tour of navground</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../packages/index.html">Packages</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../packages/navground_core.html">navground_core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages/navground_py.html">navground_py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages/navground_sim.html">navground_sim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages/navground_ros.html">navground_ros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages/navground_msgs.html">navground_msgs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages/navground_coppeliasim.html">navground_coppeliasim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages/navground_examples.html">navground_examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages/navground_examples_py.html">navground_examples_py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages/navground_demos.html">navground_demos</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="designing_an_experiment.html">Designing an experiment</a></li>
<li class="toctree-l2"><a class="reference internal" href="running_an_experiment.html">Running and analysing experiments</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../guides/index.html">Guides</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/register.html">How to register a component</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../scenarios/index.html">Benchmark scenarios</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../scenarios/antipodal.html">Antipodal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenarios/corridor.html">Corridor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenarios/cross.html">Cross</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/core/index.html">Core</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../reference/core/cpp/index.html">C++ API</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/common.html">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/auto_registration.html">Auto registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/yaml.html">YAML</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/kinematics.html">Kinematics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/target.html">Target</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/behaviors/index.html">Behaviors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/state.html">Environment State</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/collision_computation.html">Computing collisions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/modulations.html">Modulations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/controller.html">Controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/cpp/helper.html">Helpers</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../reference/core/python/index.html">Python API</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/python/common.html">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/python/auto_registration.html">Auto registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/python/yaml.html">YAML</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/python/kinematics.html">Kinematics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/python/target.html">Target</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/python/behaviors/index.html">Behaviors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/python/state.html">Environment State</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/python/collision_computation.html">Computing collisions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/python/modulations.html">Modulations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/python/controller.html">Controller</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../reference/core/yaml/index.html">YAML Schemas</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/yaml/common.html">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/yaml/auto_registration.html">Auto registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/yaml/kinematics.html">Kinematics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/yaml/social_margin.html">Social margin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/yaml/behavior.html">Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/core/yaml/state.html">Environment State</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/sim/index.html">Simulation</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../reference/sim/cpp/index.html">C++ API</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/cpp/world.html">World</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/cpp/agent.html">Agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/cpp/tasks/index.html">Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/cpp/state_estimations/index.html">State estimations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/cpp/sampling.html">Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/cpp/scenarios/index.html">Scenarios</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/cpp/experiment.html">Experiment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/cpp/yaml.html">YAML</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../reference/sim/python/index.html">Python API</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/python/world.html">World</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/python/agent.html">Agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/python/tasks/index.html">Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/python/state_estimations/index.html">State estimations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/python/scenarios/index.html">Scenarios</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/python/experiment.html">Experiment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/python/yaml.html">YAML</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../reference/sim/yaml/index.html">YAML Schemas</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/yaml/world.html">World</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/yaml/agent.html">Agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/yaml/task.html">Task</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/yaml/state_estimation.html">State estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/yaml/samplers.html">Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/yaml/scenario.html">Scenario</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sim/yaml/experiment.html">Experiment</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tutorials/tour.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>A tour of navground</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Behaviors">Behaviors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Registers">Registers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Trajectory">Trajectory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Environment-state">Environment state</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Controllers">Controllers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#More-agents">More agents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Simulation">Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Experiment">Experiment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#YAML">YAML</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Real-time-simulation">Real-time simulation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="A-tour-of-navground">
<h1>A tour of navground<a class="headerlink" href="#A-tour-of-navground" title="Link to this heading">#</a></h1>
<p>In this tour you meet the basic components of the navigation playground and see them at play.</p>
<p>At the core of the playground there is a library of navigation behaviors for dynamic obstacle avoidance.</p>
<p>Let’s import the library and instantiate one of the behavior (<a class="reference external" href="../reference/core/python/behaviors/dummy.html#navground.core.behaviors.DummyBehavior">DummyBehavior</a>).</p>
<section id="Behaviors">
<h2>Behaviors<a class="headerlink" href="#Behaviors" title="Link to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">navground</span> <span class="kn">import</span> <span class="n">core</span>

<span class="n">behavior</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">behaviors</span><span class="o">.</span><span class="n">DummyBehavior</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>A behavior holds the <strong>2D state of an agent</strong> of circular shape.</p>
<p>We set</p>
<ul class="simple">
<li><p>the <a class="reference external" href="../reference/core/python/common.html#navground.core.Pose2">pose</a> of the agent at the origin of the world-fixed coordinate frame,</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">pose</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Pose2</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>the <a class="reference external" href="../reference/core/python/common.html#navground.core.Twist2">twist</a> of the agent to zero,</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">twist</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Twist2</span><span class="p">(</span><span class="n">velocity</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angular_speed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>and the radius of the agent.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
</div>
<p>A behavior needs also a <a class="reference external" href="../reference/core/python/target.html#navground.core.Target">target</a>: let’s go to <code class="docutils literal notranslate"><span class="pre">(10,</span> <span class="pre">0)</span></code>, stopping when near enough.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Target</span><span class="o">.</span><span class="n">Point</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Once we have set a target, we can ask for a <a class="reference external" href="../reference/core/python/behaviors/behavior.html#navground.core.Behavior.compute_cmd">control command</a> (a twist) to advance towards the target in the next control step.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">compute_cmd</span><span class="p">(</span><span class="n">time_step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Missing kinematics!
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Twist2((0.000000, 0.000000), 0.000000, frame=Frame.absolute)
</pre></div></div>
</div>
<p>Oops … the behavior is complaining that it does not know the kinematics of the agent. Therefore, it plays safe and makes the agent stay in place. We also see that <code class="docutils literal notranslate"><span class="pre">Twist2</span></code> has an additional field <code class="docutils literal notranslate"><span class="pre">Twist2(...,</span> <span class="pre">frame)</span></code> for the reference frame, which can be either an absolute world-fixed frame or a relative frame attached to to the agent.</p>
<p>A <a class="reference external" href="../reference/core/python/kinematics.html#navground.core.Kinematics">kinematics</a> model knows the maximal speed of the agent and, more generally, which commands are feasible. Let’s pick an omnidirectional kinematics that has no restrictions apart from maximal horizontal and angular speeds,</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">kinematics</span><span class="o">.</span><span class="n">OmnidirectionalKinematics</span><span class="p">(</span><span class="n">max_speed</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">max_angular_speed</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">behavior</span><span class="o">.</span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">kinematics</span>
</pre></div>
</div>
</div>
<p>and ask again for a control command.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmd</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">compute_cmd</span><span class="p">(</span><span class="n">time_step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cmd</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Twist2((2.000000, 0.000000), 0.000000, frame=Frame.absolute)
</pre></div></div>
</div>
<p>As expected, the behavior wants to advance full speed towards the target point. How to actuate the commands depends on the agent we are controlling and may require interacting with the agent’s runtime.</p>
<p>Here, we keep it simple and simulate movements without any error: we apply the command for a time step to directly update the behavior state.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">actuate</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">time_step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To get the same result, we could have manually integrated the pose and set the twist.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">pose</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">time_step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">behavior</span><span class="o">.</span><span class="n">twist</span> <span class="o">=</span> <span class="n">cmd</span>
</pre></div>
</div>
</div>
<p>Note that behaviors are already instatiated at the origin and with zero twist, therefore we could have setup the behavior using just two lines:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">behaviors</span><span class="o">.</span><span class="n">DummyBehavior</span><span class="p">(</span><span class="n">kinematics</span><span class="o">=</span><span class="n">kinematics</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">behavior</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Target</span><span class="o">.</span><span class="n">Point</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Registers">
<h2>Registers<a class="headerlink" href="#Registers" title="Link to this heading">#</a></h2>
<p>What if our agent has wheels? Which other kinematics are there?</p>
<p>Implemented kinematics are stored in a register. Let’s list their names:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">core</span><span class="o">.</span><span class="n">Kinematics</span><span class="o">.</span><span class="n">types</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;2WDiff&#39;, &#39;4WOmni&#39;, &#39;Ahead&#39;, &#39;Omni&#39;]
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&quot;Omni&quot;</span></code> is the one we already used. Let’s pick <code class="docutils literal notranslate"><span class="pre">&quot;2WDiff&quot;</span></code>, which corresponds to a robot with two differential drive wheels, one at each side of a longitudinal axis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Kinematics</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="s2">&quot;2WDiff&quot;</span><span class="p">)</span>
<span class="n">kinematics</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
</div>
<p>Registered components, like kinematics, declare properties that we can use to configure them. Let’s get all properties of this kinematics model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">kinematics</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Property </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s1"> of type </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Property wheel_axis: Wheel Axis of type float
</pre></div></div>
</div>
<p>We set the wheel axis length to the size of the agent.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kinematics</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wheel_axis&quot;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that instantiating a kinematics from a register and configuring through its properties, like we have just done, is equivalent to an explicit instantiation like</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">kinematics</span><span class="o">.</span><span class="n">TwoWheelsDifferentialDriveKinematics</span><span class="p">(</span><span class="n">max_speed</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s now get a command that respects this kinematics,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">kinematics</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">compute_cmd</span><span class="p">(</span><span class="n">time_step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cmd</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Twist2((1.000000, 0.000000), 0.000000, frame=Frame.relative)
</pre></div></div>
</div>
<p>which we can convert to left and right wheel speeds.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">kinematics</span><span class="o">.</span><span class="n">wheel_speeds</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1.0, 1.0]
</pre></div></div>
</div>
<p>Again and unsurprisingly, the behavior wants to set both wheels at the same maximal speed to advance straight at full speed.</p>
</section>
<section id="Trajectory">
<h2>Trajectory<a class="headerlink" href="#Trajectory" title="Link to this heading">#</a></h2>
<p>Applying the control step iteratively, we make the agent reach the target point, while we also store its position to later plot the trajectory.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">time_step</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">behavior</span><span class="o">.</span><span class="n">check_if_target_satisfied</span><span class="p">():</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">behavior</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">compute_cmd</span><span class="p">(</span><span class="n">time_step</span><span class="o">=</span><span class="n">time_step</span><span class="p">)</span>
    <span class="n">behavior</span><span class="o">.</span><span class="n">actuate</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">time_step</span><span class="o">=</span><span class="n">time_step</span><span class="p">)</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">behavior</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">behavior</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
<span class="c1"># ax.add_patch(plt.Circle(behavior.target.position, behavior.target.position_tolerance, color=&#39;red&#39;, alpha=0.6, fill=False))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tour_41_0.png" src="../_images/tutorials_tour_41_0.png" />
</div>
</div>
<p>We got the trajectory we expected, altough not a particularly interesting one.</p>
</section>
<section id="Environment-state">
<h2>Environment state<a class="headerlink" href="#Environment-state" title="Link to this heading">#</a></h2>
<p>The job of the behavior is to navigate the agent through obstacles. So let’s add a round obstacle in the middle of the agent’s path.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disc</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Disc</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>How do we tell the behavior to avoid the obstacle? For this, each behavior keeps an enviroment state … unfortunately our current behavior, as we may expect from a behavior called <em>Dummy</em>, does not have one.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">environment_state</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>So, let’s switch to a smarter behavior. Like for kinematics, behaviors are registered by name</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">core</span><span class="o">.</span><span class="n">Behavior</span><span class="o">.</span><span class="n">types</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;Dummy&#39;, &#39;HL&#39;, &#39;HRVO&#39;, &#39;ORCA&#39;, &#39;PyDummy&#39;, &#39;SocialForce&#39;]
</pre></div></div>
</div>
<p>We pick <code class="docutils literal notranslate"><span class="pre">&quot;ORCA&quot;</span></code> and setup it with the same kinematics, state, and target as before.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Behavior</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="s1">&#39;ORCA&#39;</span><span class="p">)</span>
<span class="n">behavior</span><span class="o">.</span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">kinematics</span>
<span class="n">behavior</span><span class="o">.</span><span class="n">pose</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Pose2</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">behavior</span><span class="o">.</span><span class="n">twist</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Twist2</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">behavior</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">behavior</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Target</span><span class="o">.</span><span class="n">Point</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This behavior has a more usefull enviroment state which contains static obstacles:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">environment_state</span><span class="o">.</span><span class="n">static_obstacles</span> <span class="o">=</span> <span class="p">[</span><span class="n">disc</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Let’s check that the behavior is really considering the obstacle:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">compute_cmd</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Twist2((0.150420, 0.000000), -0.224969, frame=Frame.relative)
</pre></div></div>
</div>
<p>In fact, the behavior is telling us to steer clockwise to avoid the obstacle. Let’s plot the new trajectory.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">behavior</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">satisfied</span><span class="p">(</span><span class="n">behavior</span><span class="o">.</span><span class="n">pose</span><span class="p">):</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">behavior</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">compute_cmd</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">behavior</span><span class="o">.</span><span class="n">actuate</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">disc</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">disc</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">behavior</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">behavior</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tour_57_0.png" src="../_images/tutorials_tour_57_0.png" />
</div>
</div>
<p>Indeed, the agent does a more interesting trajectory!</p>
</section>
<section id="Controllers">
<h2>Controllers<a class="headerlink" href="#Controllers" title="Link to this heading">#</a></h2>
<p>Controllers monitor a behavior to report when it has reached a target.</p>
<p>Let’s try again the same scenario but now using a controller.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span><span class="o">.</span><span class="n">pose</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Pose2</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">behavior</span><span class="o">.</span><span class="n">twist</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Twist2</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Controller</span><span class="p">(</span><span class="n">behavior</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can tell the control to direcly actuate each control commands in a callback.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_step</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="k">def</span> <span class="nf">actuate</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
    <span class="n">behavior</span><span class="o">.</span><span class="n">actuate</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">time_step</span><span class="o">=</span><span class="n">time_step</span><span class="p">)</span>

<span class="n">controller</span><span class="o">.</span><span class="n">set_cmd_cb</span><span class="p">(</span><span class="n">actuate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Targets are now set through the controller that returns an <em>action</em>,</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">action</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">go_to_pose</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Pose2</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">3.14</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>which we can use to setup a terminal callback.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">action</span><span class="o">.</span><span class="n">done_cb</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">action_state</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Action has finished with </span><span class="si">{</span><span class="n">action_state</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Commands are now queried through the controller which in turns monitors the action state. The run-loop becomes simpler as we need just a single line per step (in addition to the usual line to store the trajectory).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">controller</span><span class="o">.</span><span class="n">idle</span><span class="p">:</span>
    <span class="n">controller</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">time_step</span><span class="o">=</span><span class="n">time_step</span><span class="p">)</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">behavior</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Action has finished with State.success.
</pre></div></div>
</div>
</section>
<section id="More-agents">
<h2>More agents<a class="headerlink" href="#More-agents" title="Link to this heading">#</a></h2>
<p>Within the playground, we can play with more than a single agent. Let’s add a second agent with the same shape, kinematics, and type of behavior.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior_1</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Behavior</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="s2">&quot;ORCA&quot;</span><span class="p">)</span>
<span class="n">behavior_1</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">behavior_1</span><span class="o">.</span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">kinematics</span>
<span class="n">behavior_2</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Behavior</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="s2">&quot;ORCA&quot;</span><span class="p">)</span>
<span class="n">behavior_2</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">behavior_2</span><span class="o">.</span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">kinematics</span>
<span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span><span class="n">behavior_1</span><span class="p">,</span> <span class="n">behavior_2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>We want to make them cross. Let them start from opposing poses</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior_1</span><span class="o">.</span><span class="n">pose</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Pose2</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">behavior_2</span><span class="o">.</span><span class="n">pose</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Pose2</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>and then exchange positions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior_1</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Target</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">behavior_2</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">behavior_2</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Target</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">behavior_1</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We need to tell the behaviors that there is another agent in their vicinity, a <em>neighbor</em>.</p>
<p>Neighbors are also of circular shape and their state consists of position, radius, and velocity. For real agents, enviroment state would originate from perception, which may be noisy and have partial visibility. Here, we keep it simple and make the agents aware of all other agents, adding all of them as neighbors in a perfectly accurate enviroment state.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
    <span class="n">behavior</span><span class="o">.</span><span class="n">environment_state</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Neighbor</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">velocity</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">behaviors</span> <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">behavior</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
<p>Let’s try again to compute the trajectories. Contrary to static obstacles, neighbors … do move. Therefore, we need to update them before asking for a new control commands.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">time_step</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="k">while</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">satisfied</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">pose</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">):</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">b</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">])</span>
    <span class="n">cmds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
        <span class="n">behavior</span><span class="o">.</span><span class="n">environment_state</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">core</span><span class="o">.</span><span class="n">Neighbor</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">velocity</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">behaviors</span> <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">behavior</span>
        <span class="p">]</span>
        <span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">behavior</span><span class="o">.</span><span class="n">compute_cmd</span><span class="p">(</span><span class="n">time_step</span><span class="o">=</span><span class="n">time_step</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">behaviors</span><span class="p">,</span> <span class="n">cmds</span><span class="p">):</span>
        <span class="n">behavior</span><span class="o">.</span><span class="n">actuate</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">time_step</span><span class="o">=</span><span class="n">time_step</span><span class="p">)</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">behavior</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">behaviors</span><span class="p">,</span> <span class="s1">&#39;bg&#39;</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">behavior</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">positions</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tour_79_0.png" src="../_images/tutorials_tour_79_0.png" />
</div>
</div>
<p>We see how the two agents successfull avoid a collision and manage to exchange positions.</p>
<p>This concludes the tour of the core part of the playground. It you want to integrate some of its components in your system, go ahead and skip the rest of the tour, which goes deeper into simulation.</p>
</section>
<section id="Simulation">
<h2>Simulation<a class="headerlink" href="#Simulation" title="Link to this heading">#</a></h2>
<p>We have seen how to manually write a run-loop to simulate a trajectory. The playground simplifies this process using <code class="docutils literal notranslate"><span class="pre">Agent</span></code>, <code class="docutils literal notranslate"><span class="pre">StateEstimation</span></code> and <code class="docutils literal notranslate"><span class="pre">Task</span></code>, which generalize the functionalities we have been implementing.</p>
<p>An agent holds a behavior and a kinematics.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">navground</span> <span class="kn">import</span> <span class="n">sim</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">Agent</span><span class="p">()</span>
<span class="n">agent</span><span class="o">.</span><span class="n">behavior</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Behavior</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="s1">&#39;ORCA&#39;</span><span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">kinematics</span><span class="o">.</span><span class="n">TwoWheelsDifferentialDriveKinematics</span><span class="p">(</span><span class="n">max_speed</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">pose</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Pose2</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">twist</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Twist2</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
</div>
<p>An agent also has a <em>task</em> to generate navigation targets. Let’s pick <code class="docutils literal notranslate"><span class="pre">WaypointsTask</span></code> to ask the agent to pendle between two points.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agent</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">WaypointsTask</span><span class="p">(</span><span class="n">waypoints</span><span class="o">=</span><span class="p">[(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally, an agent uses a <em>state estimation</em> to update the … its behavior environment <em>state</em>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agent</span><span class="o">.</span><span class="n">state_estimation</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">state_estimations</span><span class="o">.</span><span class="n">BoundedStateEstimation</span><span class="p">(</span><span class="n">range_of_view</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s now add the agent to a world, together with the same static obstacle we have been using.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">World</span><span class="p">()</span>
<span class="n">world</span><span class="o">.</span><span class="n">add_obstacle</span><span class="p">(</span><span class="n">disc</span><span class="p">)</span>
<span class="n">world</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>That’s all we have to do to setup our simulation.</p>
<p>Let’s run it for a while.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Nice … but we would like to plot the trajectory again.</p>
<p>We can iteratively run the simulation one step at time while accumulating data</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">world</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">world</span><span class="o">.</span><span class="n">agents</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>or we can add a callback where to accumulate data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cb</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">world</span><span class="o">.</span><span class="n">agents</span><span class="p">])</span>

<span class="n">world</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We perform additional steps to reach a total of 250 steps:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span><span class="o">.</span><span class="n">run_until</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">world</span><span class="o">.</span><span class="n">step</span> <span class="o">&gt;=</span> <span class="mi">250</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s plot the resulting trajectory.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">disc</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">disc</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ps</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ps</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">behavior</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tour_98_0.png" src="../_images/tutorials_tour_98_0.png" />
</div>
</div>
</section>
<section id="Experiment">
<h2>Experiment<a class="headerlink" href="#Experiment" title="Link to this heading">#</a></h2>
<p>Instead of manually injecting data collection in the run-loop, we can configure an <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> to do it automatically.</p>
<p>Let’s start by defining a scenario, which is an object that initializes worlds, grouping together the commands we have been using.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="k">class</span> <span class="nc">MyScenario</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">Scenario</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_world</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">world</span><span class="p">:</span> <span class="n">sim</span><span class="o">.</span><span class="n">World</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">init_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">Agent</span><span class="p">()</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">behavior</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Behavior</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="s1">&#39;ORCA&#39;</span><span class="p">)</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">kinematics</span><span class="o">.</span><span class="n">TwoWheelsDifferentialDriveKinematics</span><span class="p">(</span><span class="n">max_speed</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">pose</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Pose2</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">twist</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Twist2</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">WaypointsTask</span><span class="p">(</span><span class="n">waypoints</span><span class="o">=</span><span class="p">[(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">state_estimation</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">state_estimations</span><span class="o">.</span><span class="n">BoundedStateEstimation</span><span class="p">(</span><span class="n">range_of_view</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
        <span class="n">world</span><span class="o">.</span><span class="n">add_obstacle</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Disc</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">world</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then, we configure an experiment to run such scenario for some steps.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">Experiment</span><span class="p">()</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">scenario</span> <span class="o">=</span> <span class="n">MyScenario</span><span class="p">()</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">time_step</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">steps</span><span class="o">=</span> <span class="mi">300</span>
</pre></div>
</div>
</div>
<p>We are interested to record poses,</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">record_pose</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<p>so let’s run the experiment.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">run_once</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The experiment recorded metadata such as duration,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">run_duration</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
datetime.timedelta(microseconds=101)
</pre></div></div>
</div>
<p>as well as the agents’ trajectory, as an array of <code class="docutils literal notranslate"><span class="pre">steps</span> <span class="pre">x</span> <span class="pre">agents</span> <span class="pre">x</span> <span class="pre">3</span></code> coordinates.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trajectories</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">poses</span><span class="p">)</span>
<span class="n">trajectories</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(300, 1, 3)
</pre></div></div>
</div>
<p>Optionally, we can configure the experiment to automatically save all data to an HDF5 file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">pathlib</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">runs</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">save_directory</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

<span class="c1"># experiment.run()</span>
<span class="c1"># if experiment.path:</span>
<span class="c1">#     data = h5py.File(pathlib.Path(experiment.path))</span>
<span class="c1">#     data</span>
</pre></div>
</div>
</div>
</section>
<section id="YAML">
<h2>YAML<a class="headerlink" href="#YAML" title="Link to this heading">#</a></h2>
<p>What we configured in Python during this tutorial, can be configured in YAML too.</p>
<p>For instance, let’s configure the previous experiment using YAML. We add our lonely agent in one of the <code class="docutils literal notranslate"><span class="pre">scenario/groups</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yaml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">time_step: 0.1</span>
<span class="s2">steps: 300</span>
<span class="s2">record_pose: true</span>
<span class="s2">scenario:</span>
<span class="s2">    obstacles:</span>
<span class="s2">        - position: [5, 0.1]</span>
<span class="s2">          radius: 1.0</span>
<span class="s2">    groups:</span>
<span class="s2">        - number: 1</span>
<span class="s2">          type: thymio</span>
<span class="s2">          behavior:</span>
<span class="s2">            type: ORCA</span>
<span class="s2">          kinematics:</span>
<span class="s2">            type: 2WDiff</span>
<span class="s2">            wheel_axis: 2</span>
<span class="s2">            max_speed: 1</span>
<span class="s2">          task:</span>
<span class="s2">            type: Waypoints</span>
<span class="s2">            loop: true</span>
<span class="s2">            tolerance: 0.1</span>
<span class="s2">            waypoints: [[10, 0], [0, 0]]</span>
<span class="s2">          state_estimation:</span>
<span class="s2">            type: Bounded</span>
<span class="s2">            range_of_view: 5</span>
<span class="s2">          position: [0, 0]</span>
<span class="s2">          orientation: 0</span>
<span class="s2">          radius: 1.0</span>
<span class="s2">          control_period: 0.1</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">load_experiment</span><span class="p">(</span><span class="n">yaml</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">run_once</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>YAML is also usefull to display a readable representation. Let’s try to look at world at the end of the experiment:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">world</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
obstacles:
  - position:
      - 5
      - 0.100000001
    radius: 1
    uid: 5
walls:
  []
agents:
  - behavior:
      type: ORCA
      effective_center: false
      time_horizon: 10
      optimal_speed: 1
      optimal_angular_speed: 1
      rotation_tau: 0.5
      safety_margin: 0
      horizon: 5
      radius: 1
      heading: velocity
      kinematics:
        type: 2WDiff
        wheel_axis: 2
        max_speed: 1
        max_angular_speed: 1
      social_margin:
        modulation:
          type: constant
        default: 0
    kinematics:
      type: 2WDiff
      wheel_axis: 2
      max_speed: 1
      max_angular_speed: 1
    task:
      type: Waypoints
      loop: true
      tolerance: 0.100000001
      waypoints:
        -
          - 10
          - 0
        -
          - 0
          - 0
    state_estimation:
      type: Bounded
      range_of_view: 5
    position:
      - 0.0844370797
      - 0.0417474806
    orientation: 4.70049715
    velocity:
      - 0
      - -0
    angular_speed: 1
    radius: 1
    control_period: 0.100000001
    type: thymio
    id: 0
    uid: 4
</pre></div></div>
</div>
</section>
<section id="Real-time-simulation">
<h2>Real-time simulation<a class="headerlink" href="#Real-time-simulation" title="Link to this heading">#</a></h2>
<p>This last part is possibly the most rewarding of the tour.</p>
<p>Let’s try to visualize a simulation while it runs directly in the notebook. For this, you need to install the Python websockets package</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install websockets
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">navground.sim.ui.web_ui</span> <span class="kn">import</span> <span class="n">WebUI</span>
<span class="kn">from</span> <span class="nn">navground.sim.ui.to_html</span> <span class="kn">import</span> <span class="n">notebook_view</span>
<span class="kn">from</span> <span class="nn">navground.sim.real_time</span> <span class="kn">import</span> <span class="n">RealTimeSimulation</span>

<span class="n">web_ui</span> <span class="o">=</span> <span class="n">WebUI</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">max_rate</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">await</span> <span class="n">web_ui</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">notebook_view</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<!DOCTYPE html>

<html>
<head>
  <!--  -->
  <title></title>

  <style>
  svg{
  style='stroke-width: 0px;
  background-color: snow;
}
.background{
  fill-opacity:0.05;
  fill: grey;
}
circle.obstacle{
  fill: gray;
  stroke:none;
}
.agent{
  stroke:none;
  fill: orange;
}
polyline.wall{
  stroke:black;
  stroke-width:0.01;
}


  </style>


  <script type='text/javascript'>
  var svg;
var svg_world;



// require.config({
//   paths: {
//     'svg-pan-zoom': 'https://cdnjs.cloudflare.com/ajax/libs/svg.pan-zoom.js/2.7.0/svg.pan-zoom.min.js'
//   }
// })

// require(["svg-pan-zoom"], function(svgPanZoom) {
//   window.svgPanZoom = svgPanZoom('#N0svg', {
//     panEnabled: true,
//     controlIconsEnabled: true,
//     zoomEnabled: true,
//     fit: true,
//     maxZoom: 200,
//     minZoom: 0.1
//   });
//   svg = document.getElementsByClassName("svg-pan-zoom_viewport")[0];
//   svg_world = document.getElementById("N0world");
// });







var ws_address = "ws://127.0.0.1:8000/"
var ws = new WebSocket(ws_address);

ws.onopen = function(event) {
  console.log('N0 Opened Web socket ' + ws_address)
};

ws.onmessage = function(event) {
  var [type, data] = JSON.parse(event.data)
  switch (type) {
    case 'm':
      move(data)
      break;
    case 'r':
      reset(data)
      break;
    case 's':
      set(data)
      break;
    case 'v':
      view(data)
      break;
    case '+':
      add(data)
      break;
    default:
      break
  }
}


var agents = new Set();
var entity = {};
var NS = "http://www.w3.org/2000/svg";
var prototypes = {'': '#N0agent', 'thymio': '#N0thymio', 'wheelchair': '#N0wheelchair', 'human': '#N0human'}

function add_wall(id, points) {
  var e = document.createElementNS(NS,"polyline");
  var ps = []
  for (var i in points) {
     ps.push(`${points[i][0]},${points[i][1]}`)
  }
  e.setAttribute("points", ps.join())
  e.setAttribute("class", "wall");
  e.setAttribute("id", id);
  return e
}

function add_obstacle(id, point, radius) {
  var e = document.createElementNS(NS,"circle");
  e.setAttribute("cx", `${point[0]}`)
  e.setAttribute("cy", `${point[1]}`)
  e.setAttribute("r", `${radius}`)
  e.setAttribute("class", "obstacle");
  e.setAttribute("id", id);
  return e
}

function add_agent(id, type, size)
{
  var g = document.createElementNS(NS,"g");
  var agent = document.createElementNS(NS,"use");
  var uid = prototypes[type] || '#N0agent';
  agent.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", uid);
  agent.setAttribute("transform", `scale(${size}, ${size})`)
  g.appendChild(agent)
  g.setAttribute("class", type);
  g.setAttribute("id", id);
  return g;
};

function add_entity(uid, data) {
  var id = "N0" + uid
  if (id in entity) {
    console.warn(`Entity ${id} already present`)
    return;
  }
  var kind = data['kind'];
  var svg_world = document.getElementById("N0world");
  var e = document.getElementById(id);
  if (e) {
    svg_world.removeChild(e);
    e = null;
  }
  var state = null;
  switch (kind) {
    case 'w':
      e = add_wall(id, data['points']);
      break;
    case 'o':
      e = add_obstacle(id, data['point'], data['radius']);
      break;
    case 'a':
      e = add_agent(id, data['type'], data['size']);
      state = data['pose']
      var [x, y, theta] = state;
      move_element(e, x, y, theta);
      agents.add(id);
      break;
    default:
      break
  }
  if (e) {
    svg_world.appendChild(e);
    entity[id] = {'svg': e, 'updated': true, 'state': state};
  }
};

function add(data) {
  for (var _id in data) {
    add_entity(_id, data[_id])
  }
  window.requestAnimationFrame(update);
};

function set_entity(_id, data) {
  if(!(_id in entity)) {
    console.warn(`Entity ${_id} unknown`)
    return;
  }
  for (a in data) {
    entity[_id]['svg'].setAttribute(a, data[a])
  }
};

function set(data) {
  for (var _id in data) {
    if (_id in entity) {
      set_entity('N0' + _id, data[_id])
    } else {
      var e = document.getElementById("N0" + _id);
      if (e) {
        var e_data = data[_id];
        for (a in e_data) {
          console.log(`setting attributes ${a} of ${e} to ${e_data[a]}`)
          e.setAttribute(a, e_data[a]);
        }
      }
    }
  }
  window.requestAnimationFrame(update);
};

function move_entity(_id, data) {
  if(!agents.has(_id)) {
    console.warn(`Agent ${_id} unknown`)
    return;
  }
  var [x, y, theta] = data;
  entity[_id]['state'] = [x, y, theta]
  entity[_id]['updated'] = true
};

function move(data) {
  for (var _id in data) {
    move_entity('N0' + _id, data[_id])
  }
  window.requestAnimationFrame(update);
};

function reset() {
  var svg_world = document.getElementById("N0world");
  for (var _id in entity) {
    svg_world.removeChild(entity[_id]['svg'])
  }
  console.log("reset")
  entity = {}
  agents.clear()
  window.requestAnimationFrame(update);
};

function view(data) {
  var [x, y, width, height] = data;
  var svg = document.getElementById("N0svg");
  svg.setAttribute("viewBox", `${x} ${y} ${width} ${height}`)
  window.requestAnimationFrame(update);
};

function update(step) {
  var ids_to_be_removed = []
  for (var id of agents) {
    // if (!entity[id]['updated']) {
    //   ids_to_be_removed.push(id)
    // }
    if (entity[id]['updated']) {
      var [x, y, theta] = entity[id]['state']
      move_element(entity[id]['svg'], x, y, theta)
      entity[id]['updated'] = false;
    }
  }
  // for (var _id of ids_to_be_removed) {
  //   remove_entity(_id);
  // }
};

function remove_entity(_id) {
    var svg_world = document.getElementById("N0world");
    console.log(`remove ${_id}`)
    svg_world.removeChild(entity[_id]['svg'])
    agents.delete(_id);
    delete entity[_id];
}

function move_element(g, x, y, angle) {
  var t = `translate(${x},${y}) rotate(${angle * 180 / 3.14159})`
  g.setAttribute("transform", t)
};

  </script>


</head>
<body>
  <div>
    <h1></h1>
  </div>
  <svg id="N0svg" width="500" height="500" viewBox="0 0 1 1 ">
    <defs>
        <circle id="N0agent" cx="0" cy="0" r="1"/>
        <g id="N0thymio" transform="rotate(90) scale(0.125)" fill="#e6e6e6">
            <path
               style="stroke:none"
               d="M -5.4999227 -5.8058472 L -5.4999227 2.9998169 L 5.4999227 2.9998169 L 5.4999227     -5.8089478 A 8 8 0 0 0 0 -8.0000285 A 8 8 0 0 0 -5.4999227 -5.8058472 z " />
            <rect
               style="fill:#333333;stroke:none"
               width="1.5"
               height="4.1999998"
               x="-5.4000001"
               y="-2.0999999"
               rx="0.5" />
            <rect
               style="fill:#333333;stroke:none"
               id="rect441"
               width="1.5"
               height="4.1999998"
               x="3.9000001"
               y="-2.0999999"
               rx="0.5" />
        </g>
<g id="N0wheelchair" transform="scale(0.02) rotate(180) translate(-55,-173)">
      <path
         id="path7"
         style="fill:#c8beb7;stroke:none;stroke-width:214.829"
         d="m 48.06149,189.83177 h -38.89 v -33.33 h 38.89 z"
         inkscape:transform-center-x="53.187398"
         inkscape:transform-center-y="-39.069755" />
      <path
         style="color:#000000;fill:#080808;stroke:none;-inkscape-stroke:none"
         d="m 81.382974,148.5266 v -4.11718 -4.21485 H 53.61149 v 8.33203 z"
         id="path8" />
      <path
         style="color:#000000;fill:#080808;stroke:none;-inkscape-stroke:none"
         d="m 81.382974,204.0666 v -4.11718 -4.21485 H 53.61149 v 8.33203 z"
         id="path9" />
      <path
         id="path10"
         style="fill:#483e37;stroke:none;stroke-width:314.501"
         d="m 92.497232,199.91402 h -50 v -55.55999 h 50 z" />
      <path
         style="color:#000000;fill:#917c6f;stroke:none;-inkscape-stroke:none"
         d="m 92.497232,199.91332 v -2.77148 -52.78711 h -5.558593 v 55.55859 z"
         id="path11" />
    </g>
    <g id="N0human" transform="scale(0.02) rotate(180) translate(-50,-175)">
    <ellipse
       style="fill:#666666;fill-opacity:1;stroke:none;stroke-width:0.605428;stroke-dasharray:none"
       id="circle11"
       cx="54.378712"
       cy="172.97321"
       rx="19.763088"
       ry="43.396534" />
    <ellipse
       style="fill:#1a1a1a;fill-opacity:1;stroke:none;stroke-width:0.34029;stroke-dasharray:none"
       id="ellipse11"
       cx="54.378712"
       cy="172.90125"
       rx="16.28758"
       ry="16.635132" />
    <ellipse
       style="fill:#666666;fill-opacity:1;stroke:none;stroke-width:0.262666;stroke-dasharray:none"
       id="ellipse12"
       cx="40.156387"
       cy="134.79787"
       rx="23.189381"
       ry="6.961535" />
    <ellipse
       style="fill:#666666;fill-opacity:1;stroke:none;stroke-width:0.262666;stroke-dasharray:none"
       id="ellipse13"
       cx="40.156387"
       cy="211.14854"
       rx="23.189381"
       ry="6.961535" />
    </g>
    </defs>
    <g id='N0world' transform="scale(1, -1)">

    </g>
  </svg>
</body>
</html></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we run 5x faster than real-time</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">world</span>
<span class="n">rt_sim</span> <span class="o">=</span> <span class="n">RealTimeSimulation</span><span class="p">(</span><span class="n">world</span><span class="o">=</span><span class="n">world</span><span class="p">,</span> <span class="n">time_step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">web_ui</span><span class="o">=</span><span class="n">web_ui</span><span class="p">,</span>
                            <span class="n">bounds</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="k">await</span> <span class="n">rt_sim</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">until_time</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">time</span> <span class="o">+</span> <span class="mi">60</span>
<span class="k">await</span> <span class="n">rt_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">world</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">until_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../installation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Installation</p>
      </div>
    </a>
    <a class="right-next"
       href="../packages/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Packages</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Behaviors">Behaviors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Registers">Registers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Trajectory">Trajectory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Environment-state">Environment state</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Controllers">Controllers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#More-agents">More agents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Simulation">Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Experiment">Experiment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#YAML">YAML</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Real-time-simulation">Real-time simulation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jérôme Guzzi, IDSIA
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, Jérôme Guzzi, IDSIA.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>