(function(){var container=null,markers=null,mousewheel="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll";function panZoom(opt_options){var self=this;function setPosition(x,y,z){pz.pan.iPos=pz.pan.fPos;pz.transform=self.transform();pz.transform.x=x;pz.transform.y=y;if(typeof z==="number"){pz.zoom(z)}else{updateMatrix()}return pz}function zoom(z,oX,oY,ev){if(z>opt_options.zoom[1]||z<opt_options.zoom[0]){return}if(arguments.length===1){pz.transform=pz.transform||self.transform();pz.transform.scaleY=pz.transform.scaleX=z;updateMatrix();return pz}var tr=pz.transform,currentX=tr.x,currentY=tr.y,scaleD=z/tr.scaleX,x=scaleD*(currentX-oX)+oX,y=scaleD*(currentY-oY)+oY;setPosition(x,y,z);if(ev){self.node.dispatchEvent(new CustomEvent("zoom",{detail:{e:ev,tr:tr}}))}}var pz={pan:{},elm:self,setPosition:setPosition,zoom:zoom};opt_options=Object(opt_options);opt_options.zoom=opt_options.zoom||[];opt_options.zoomSpeed=typeof opt_options.zoomSpeed==="number"?opt_options.zoomSpeed:-1;var svg=self;while((svg=self.parent()).node.tagName.toUpperCase()!=="SVG"){}var rect=new SVG(document.createDocumentFragment()).rect().attr({width:svg.width(),height:svg.height(),fill:"none"}).style("pointer-events","all");self.parent().node.insertBefore(rect.node,self.node);function updateMatrix(){self.attr("transform","matrix("+[pz.transform.scaleX,0,0,pz.transform.scaleY,pz.transform.x,pz.transform.y].join(",")+")")}function pan(e){if(!pz.pan.mousedown){return}var tr=pz.transform=self.transform();var diffX=pz.pan.fPos.x-pz.pan.iPos.x;var diffY=pz.pan.fPos.y-pz.pan.iPos.y;pz.setPosition(tr.x+diffX,tr.y+diffY);self.node.dispatchEvent(new CustomEvent("pan",{detail:{e:e,tr:tr}}))}function mousePos(e,rel){var bbox=self.parent().node.getBoundingClientRect(),abs={x:e.clientX||e.touches[0].pageX,y:e.clientY||e.touches[0].pageY};if(!rel){return abs}return{x:abs.x-bbox.left,y:abs.y-bbox.top}}function doZoom(e){var rP=mousePos(e,true),oX=rP.x,oY=rP.y;e.deltaY=e.deltaY||e.wheelDeltaY||-e.wheelDelta;var d=opt_options.zoomSpeed*e.deltaY/1e3,tr=pz.transform=self.transform(),scale=tr.scaleX+tr.scaleX*d;zoom(scale,oX,oY,e);e.preventDefault()}var EventListeners={mouse_down:function(e){pz.pan.mousedown=true;pz.pan.iPos=mousePos(e)},mouse_up:function(e){pz.pan.mousedown=false;pz.pan.fPos=mousePos(e);pan()},mouse_move:function(e){if(!pz.pan.mousedown){return}pz.pan.fPos=mousePos(e);pan()},mouse_leave:function(e){pz.pan.mousedown=false}};rect.on(mousewheel,doZoom).on("mousedown",EventListeners.mouse_down).on("touchstart",EventListeners.mouse_down).on("mousemove",EventListeners.mouse_move).on("touchmove",EventListeners.mouse_move).on("mouseup",EventListeners.mouse_up).on("touchup",EventListeners.mouse_up).on("mouseleave",EventListeners.mouse_leave);self.on(mousewheel,doZoom);return pz}SVG.extend(SVG.Element,{panZoom:panZoom})}).call(this);